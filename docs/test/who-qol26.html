<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>My experiment</title>
    <script src="../dist/jspsych.js"></script>
    <!-- survey plugins -->
    <script src="../dist/plugin-survey-multi-choice.js"></script>
    <script src="../dist/plugin-survey-likert.js"></script>
    <script src="../dist/plugin-survey-html-form.js"></script>
    <script src="../dist/plugin-survey-text.js"></script>

    <!-- misc plugins -->
    <script src="../dist/plugin-html-keyboard-response.js"></script> 
    
    <link rel="stylesheet" href="../dist/jspsych.css" />

    <style>
      .instruction {
          max-width: 40rem; 
          text-align: justify;
      }

      h2 {
        font-size: 1.5em;
        font-weight: bold;
        background-color: #c0e9ff;
        margin: 1em 0;
      }

      body {
        overflow-y: scroll; /* スクロールを有効にする */
      }
    </style>

  </head>
  <body></body>
    <script>

      var jsPsych = initJsPsych({
        on_finish: function() {
          var data = jsPsych.data.get().csv();
          var encodedUri = encodeURI("data:text/csv;charset=utf-8," + data);
          var link = document.createElement("a");
          link.setAttribute("href", encodedUri);
          link.setAttribute("download", "survey_results.csv");
          document.body.appendChild(link);
          link.click();
        }
      });

      // Page 1:被験者IDの入力 
      var survey_id = {
        type: jsPsychSurveyHtmlForm,
        html: `
        <div class="instruction">
        <h2>識別用コードを入力してください。</h2>
            あなたに割り当てられたID：<input name="participant_id" type="text" pattern="^[0-9]+$" style="width: 120px;" required>
            <br>※半角数字で入力してください。
        </div>
        `,
        required: true,
        button_label: '次へすすむ',
        on_finish: function(data) {
          // 参加者IDをjsPsychのデータストアに保存
          jsPsych.data.addProperties({participant_id: data.response.participant_id});
        }
      };


// qol26 //
    // qol26_sheet01
    var qol26_sheet01 = {
        type: jsPsychSurveyLikert,
        preamble: `
        <div class="instruction">
          <h1>WHO-QOL26</h1>
          <h2>以下の質問はあなたが<u>過去2週間</u>にどのくらいあるか評価し、満足していたかについてお聞きするものです。</h2>
        </div>
        `,
        questions: [
            {
                prompt: `<div class="instruction">Q1 自分の生活の質をどのように評価しますか。</div>`, 
                name: 'qol26_01', 
                labels: ['まったく悪い', '悪い', 'ふつう', '良い', '常に良い'], 
                values: [1, 2, 3, 4, 5], 
                required: true
            },
            {
                prompt: `<div class="instruction">Q2 自分の健康状態に満足していますか。</div>`, 
                name: 'qol26_02', 
                labels: ['まったく不満', '不満', 'どちらでもない', '満足', '非常に満足'], 
                values: [1, 2, 3, 4, 5], 
                required: true
            },
        ],
        required: true,
        button_label: '次へすすむ',
    };  


    // qol26_sheet02
    const qol26_sheet02 = {
        type: jsPsychSurveyLikert,
        preamble: `
          <div class="instruction">
            <h2>以下の質問はあなたが<u>過去2週間</u>にどのくらいある事柄を経験されたかについてお聞きするものです。</h2>
            もし、たくさん経験されていたら、「非常に」を選択してください。<br>
            もし、その事柄を経験していない場合は、「まったくない」を選択してください。
          </div>
        `,
        questions: [
        '体の痛みや不快感のせいで、しなければならないことがどのくらい制限されていますか。', 
        '毎日の生活の中で治療（医療）がどのくらい必要ですか。',
        '毎日の生活をどのくらい楽しく過ごしていますか。',
        '毎日の生活をどのくらい集中することができますか。',
        '毎日の生活はどのくらい安全ですか。',
        '自分の健康状態に満足していますか。',
        'あなたの生活環境はどのくらい健康的ですか。',
        '毎日の生活を送るための活力はありますか。',
        '自分の容姿（外見）を受け入れることができますか。',
        '必要なものを買えるだけのお金を持っていますか。',
        '毎日の生活に必要な情報をどのくらい得ることができますか。',
        '余暇を楽しむ機会はどのくらいありますか。',
        '家の周囲を出まわることがよくありますか。',
      ].map((prompt, index) => ({
        prompt: `<div class="instruction">Q${index + 3} ${prompt}</div>`, // インデックス +3 をつけて ) を追加
        name: `qol26_${String(index + 3).padStart(2, '0')}`,
        labels: ['まったくない', '少しだけ', '多少は', 'かなり', '非常に'], // 選択肢
        required: true
      })),
        
        button_label: '次へすすむ',
        on_finish: function(data) {
          const newData = {};
          Object.keys(data.response).forEach((key, idx) => {
            const value = data.response[key];
            // 特定のインデックスの場合は逆順に変換
            if (value !== null && value !== "") {
              // reverseを定義
              if ([3, 4, 26].includes(idx + 3)) {
                // 逆順である場合 5, 4, 3, 2, 1 を出力
                newData[key] = 5 - value;
              } else {
                // 通常の順序で 1, 2, 3, 4, 5 を出力
                newData[key] = value + 1;
              }
            } else {
              newData[key] = ""; // 未回答の項目はそのまま
            }
          });
          data.response = newData; // 変換後のデータを保存
        }
      };




    var qol26_sheet03 = {
        type: jsPsychSurveyLikert,
        preamble: `
          <div class="instruction">
            <h2>以下の質問はあなたが<u>過去2週間</u>にどのくらいできたか、満足したかについてお聞きするものです。</h2>
          </div>
        `,
        questions: [
        '睡眠は満足いくものですか。', 
        '毎日の活動をやり遂げる能力に満足していますか。',
        '自分の仕事をする能力に満足していますか。',
        '自分自身に満足していますか。',
        '人間関係に満足していますか。',
        '性生活に満足していますか。',
        '友人たちの支えに満足していますか。',
        '家のといえのまわりの環境に満足していますか。',
        '医療施設や福祉サービスの利用しやすさに満足していますか。',
        '周辺の交通の便に満足していますか。',
      ].map((prompt, index) => ({
        prompt: `<div class="instruction">Q${index + 16} ${prompt}</div>`, // インデックス +3 をつけて ) を追加
        name: `qol26_${String(index + 16).padStart(2, '0')}`,
        labels: ['まったく不満', '不満', 'どちらでもない', '満足', '非常に満足'], // 選択肢
        required: true
      })),
              
        button_label: '次へすすむ',
        on_finish: function(data) {
          const newData = {};
          Object.keys(data.response).forEach((key, idx) => {
            const value = data.response[key];
            // 特定のインデックスの場合は逆順に変換
            if (value !== null && value !== "") {
              // reverseを定義
              if ([3, 4, 26].includes(idx + 16)) {
                // 逆順である場合 5, 4, 3, 2, 1 を出力
                newData[key] = 5 - value;
              } else {
                // 通常の順序で 1, 2, 3, 4, 5 を出力
                newData[key] = value + 1;
              }
            } else {
              newData[key] = ""; // 未回答の項目はそのまま
            }
          });
          data.response = newData; // 変換後のデータを保存
        }
      };
      
      
      qol26_sheet04 = {
        type: jsPsychSurveyLikert,
        preamble: `
          <div class="instruction">
            <h2>以下の質問はあなたが<u>過去2週間</u>にどのくらい頻繁に経験したかについてお聞きするものです。</h2>
          </div>
        `,
        questions: [
        '気分がすぐれなかったり、絶望、不安、落ち込みといった嫌な気分をどのくらい頻繁に感じますか。',
      ].map((prompt, index) => ({
        prompt: `<div class="instruction">Q${index + 26} ${prompt}</div>`, // インデックス +3 をつけて ) を追加
        name: `qol26_${String(index + 26).padStart(2, '0')}`,
        labels: ['まったくない', '少しだけ', '多少は', 'かなり', '非常に'], // 選択肢
        required: true
      })),
              
        button_label: '次へすすむ',
        on_finish: function(data) {
          const newData = {};
          Object.keys(data.response).forEach((key, idx) => {
            const value = data.response[key];
            // 特定のインデックスの場合は逆順に変換
            if (value !== null && value !== "") {
              // reverseを定義
              if ([3, 4, 26].includes(idx + 26)) {
                // 逆順である場合 5, 4, 3, 2, 1 を出力
                newData[key] = 5 - value;
              } else {
                // 通常の順序で 1, 2, 3, 4, 5 を出力
                newData[key] = value + 1;
              }
            } else {
              newData[key] = ""; // 未回答の項目はそのまま
            }
          });
          data.response = newData; // 変換後のデータを保存
        }
    };


    //sheetをまとめる
    var qol26 = {
        timeline: [qol26_sheet01, qol26_sheet02, qol26_sheet03, qol26_sheet04]
    };

// qol26 end//

    // Start the experiment
    jsPsych.run([survey_id, 
                 qol26
                 ]);


    </script>
</html>

